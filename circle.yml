machine:
  php:
    version: 7.0.17

dependencies:
  cache_directories:
    - "~/.composer/cache"
  override:
    - composer install --no-interaction

test:
  override:
    - bin/run-phpcs
    - mkdir -p $CIRCLE_TEST_REPORTS/phpunit
    - vendor/bin/phpunit -v --log-junit $CIRCLE_TEST_REPORTS/phpunit/junit.xml tests
    - bin/coverage-ensure 100
  post:
    - mkdir $CIRCLE_ARTIFACTS/coverage
    - cp -a tmp/coverage/html/ $CIRCLE_ARTIFACTS/coverage/
    - bash <(curl -s https://codecov.io/bash)
